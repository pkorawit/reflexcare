<!DOCTYPE html>
<html>

<head>
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" href="lib/OnsenUI/css/onsenui.css">
    <link rel="stylesheet" href="lib/OnsenUI/css/onsen-css-components.min.css">
    <link rel="stylesheet" type="text/css" href="css/default.css">
    <title>SmartReflex</title>
</head>

<body>

    <ons-navigator animation="slide" swipeable="force" id="mainNavigator" style="margin-top:56px;margin-bottom:56px;"></ons-navigator>

    <ons-toolbar id="toolsbar">
        <div class="toolbar__left center">
            <ons-back-button></ons-back-button>
        </div>
        <div id="pageTitle" class="toolbar__center welcomeHeader">SMART REFLEX</div>
        <div class="toolbar__right avatar">
            <div id="thumbnailIMG" onclick="signOut();"></div>
        </div>
    </ons-toolbar>
    <ons-modal direction="up">
        <div style="text-align: center">
            <p>
                <ons-icon icon="fa-spinner" size="32px" spin></ons-icon> Loading...
            </p>
        </div>
    </ons-modal>
    <ons-bottom-toolbar modifier="aligned" class="botton-toolbar-align center">
        <ons-row>
            <ons-col width="25%">
                <div id="tab1" style="margin:auto" class="transparent-Bottom-Toolbar">
                    <img style="WIDTH:64px;padding-top:4px" onclick="changeTab('views/smartReflex.html', 'SMART REFLEX', 1);" src="UI/ai/0.75x/reflex.png"
                        alt="">
                </div>
            </ons-col>
            <ons-col width="25%">
                <div id="tab2" style="margin:auto">
                    <img style="WIDTH:52px;padding-top:7px" onclick="changeTab('views/smartCare.html', 'SMART CARE', 2)" src="UI/ai/0.75x/smartcare.png"
                        alt="">
                </div>
            </ons-col>
            <ons-col width="25%">
                <div id="tab3" style="margin:auto">
                    <img style="WIDTH:68px;padding-top:7px" onclick="changeTab('views/personal.html', 'PERSONAL INFO', 3)" src="UI/ai/0.75x/personal.png"
                        alt="">
                </div>
            </ons-col>
            <ons-col width="25%">
                <div id="tab4" style="margin:auto">
                    <img style="WIDTH:60px;padding-top:4px" onclick="changeTab('views/moreDevice.html', 'DEVICES', 4)" src="UI/ai/0.75x/moreDevice.png"
                        alt="">
                </div>
            </ons-col>
        </ons-row>
    </ons-bottom-toolbar>

    <script id="alertTemplate" type="x-tmpl-mustache">
        <ons-card>
            <ons-row>
                <ons-col class="center Sukhumvit-font marginAuto">
                    <div style="background-image:url('{{img}}');margin: auto; margin-top: 10px;" class="smartProfile72px smartProfileAlert" onclick="ChartBuilder.smartreflexPush('views/smartReflexPush.html', 'SMART sREFLEX', 1, '{{userid}}')" id="{{id}}"></div>
                    <div>
                        <ons-card class="center" style="width:90px">
                                <div>
                                    <a onclick="ChartBuilder.smartreflexPush('views/smartReflexPush.html', 'SMART REFLEX', 1, '{{userid}}')" id="{{id}}">{{name}}</a>
                                </div>
                        </ons-card>
                    </div>
                </ons-col>
                <ons-col class="center Sukhumvit-font verticalLine marginAuto">
                    <div style="height:5px"></div>
                    <div class="color">Steps</div>
                    <div>{{step}}</div>
                </ons-col>
                <ons-col class="center Sukhumvit-font verticalLine marginAuto" >
                    <div style="height:5px"></div>
                    <div class="color">Distance</div>
                    <div>{{cal}} kcal</div>
                </ons-col>
                <ons-col class="center Sukhumvit-font verticalLine marginAuto">
                    <div style="height:5px"></div>
                    <div class="color">Heart rate</div>
                    <div>{{hr}}</div>
                </ons-col>
                <ons-col class="center Sukhumvit-font verticalLine">
                        <canvas id="radarTarget{{id}}" width="80" height="180"></canvas>
                </ons-col>
            </ons-row>
        </ons-card>
    </script>

    <script id="template" type="x-tmpl-mustache">
        <ons-card>
            <ons-row>
                <ons-col class="center Sukhumvit-font marginAuto">
                    <div>
                        <img style="margin-top: 10px;" id="{{id}}" src="{{img}}" alt="" class="smartProfile72px" onclick="ChartBuilder.smartreflexPush('views/smartReflexPush.html', 'SMART REFLEX', 1, '{{userid}}')">
                    </div>
                    <div>
                        <ons-card class="center" style="width:90px">
                            <div>
                                <a smartreflexPush="ChartBuilder.smartreflexPush('views/smartReflexPush.html', 'SMART REFLEX', 1, '{{userid}}')" id="{{id}}">{{name}}</a>
                            </div>
                        </ons-card>
                    </div>
                </ons-col>
                <ons-col class="center Sukhumvit-font verticalLine marginAuto">
                    <div style="height:5px"></div>
                    <div class="color">Step</div>
                    <div>{{step}}</div>
                </ons-col>
                <ons-col class="center Sukhumvit-font verticalLine marginAuto">
                    <div style="height:5px"></div>
                    <div class="color">Distance</div>
                    <div>{{cal}} kcal</div>
                </ons-col>
                <ons-col class="center Sukhumvit-font verticalLine marginAuto">
                    <div style="height:5px"></div>
                    <div class="color">Heart rate</div>
                    <div>{{hr}}</div>
                </ons-col>
                <ons-col class="center Sukhumvit-font verticalLine">
                    <canvas id="radarTarget{{id}}" width="80" height="180"></canvas>
                </ons-col>
            </ons-row>
        </ons-card>
    </script>
    <script id="familyTemplate" type="x-tmpl-mustache">
        <div class="marginAuto">
            <img id="{{id}}" onclick="imgPush({{id}})" src="{{img}}" alt="" class="smartProfile" style="margin-bottom:0px">
            <div>
                <ons-card class="center" style="width:90px">
                    <div>
                        <a onclick="imgPush({{id}})" id="{{id}}">{{name}}</a>
                    </div>
                </ons-card>
            </div>
        </div>
    </script>

    <script id="thumbnailTamplate" type="x-tmpl-mustache">
        <img id="{{id}}" src="{{img}}" alt="" class="thumbnail">
    </script>

    <script id="profileTamplate" type="x-tmpl-mustache">
        <img src="{{img}}" alt="" class="profile">
    </script>

    <script id="recentlyTemplate" type="x-tmpl-mustache">
        <img id="{{id}}" src="{{img}}" alt="" class="profiles">
    </script>

    <script id="stepTemplate" type="x-tmpl-mustache">
        {{step}}
    </script>
    <script id="calTemplate" type="x-tmpl-mustache">
        {{cal}} kcal
    </script>
    <script id="hrTemplate" type="x-tmpl-mustache">
        {{hr}} bpm
    </script>
    <script src="lib/OnsenUI/js/onsenui.min.js"></script>
    <script src="lib/jQuery/jquery-3.3.1.js"></script>
    <script src="lib/Chart/Chart.bundle.js"></script>
    <script src="lib/Mustache/mustache.js"></script>
    <script src="lib/Gauge/gauge.js"></script>
    <script src="js/gaugeView.js"></script>
    <script src="js/utils.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-firestore.js"></script>
    <script src="js/smartreflex.js"></script>
    <script src="js/chart.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script>   
        var modal = document.querySelector('ons-modal');
        modal.show();     
        //Force android UI
        ons.platform.select('android');
        //Get logged in user id
        var loggedInUserId = SmartReflex.getUrlParameter('userid');
        //Hide default back button
        document.querySelector('ons-back-button').hide();
        //Get logon user info from backend
        var currentUser;
        SmartReflex.getUser(loggedInUserId).then(function (message, user) {

            //Init left thumbnail on toolbar
            var thumbnailTemplate = $('#thumbnailTamplate').html();
            var data = {
                img: user.profile.photo
            };
            currentUser = user;
            var imgRendered = Mustache.render(thumbnailTemplate, data);
            $('#thumbnailIMG').html(imgRendered);

            var modal = document.querySelector('ons-modal');
            
            modal.hide();

            changeTab('views/smartReflex.html', 'SMART REFLEX', 1);
        });

        function changeTab(page, pagename, highlight) {
            $('#pageTitle').html(pagename);
            document.querySelector('ons-navigator').resetToPage(page, {
                data: {
                    title: pagename,
                    currentUser: currentUser
                }
            });
            setTabHighlight(highlight);
        }

        function setTabHighlight(tabNo){
            for (var tab = 1; tab <= 4; tab++) {
                var target = '#tab' + tab;
                if (tabNo == tab) {
                    $(target).addClass('transparent-Bottom-Toolbar');
                } else {
                    $(target).removeClass('transparent-Bottom-Toolbar');
                }
            }
        }

        function signOut(){
            SmartReflex.signOut().then(function (){
                console.log('signOut');
                window.location.replace('login.html');
            }); 
        }
    </script>

</body>

</html>